<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amigo Secreto</title>
    <style>
        /* Adicione seu estilo aqui */
    </style>
</head>
<body>
    <div class="container">
        <h1>Bem-vindo ao Amigo Secreto!</h1>
        <p>Insira seu nome e senha para participar do sorteio.</p>

        <div id="nameInput">
            <input type="text" id="userName" placeholder="Digite seu nome aqui">
            <button id="nextButton">Próximo</button>
        </div>

        <div id="passwordInput" style="display: none;">
            <input type="password" id="password" placeholder="Crie uma senha">
            <button id="startDraw">Sortear</button>
        </div>
        
        <div class="result" id="result"></div>
    </div>

    <!-- Importando o Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.17.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.0/firebase-firestore.js"></script>

    <script type="module">
        // Sua configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB0luDWLYVo32_4sb-CZBMbzQhfOXGaWQI",
            authDomain: "amigosecreto-6f612.firebaseapp.com",
            projectId: "amigosecreto-6f612",
            storageBucket: "amigosecreto-6f612.firebasestorage.app",
            messagingSenderId: "451995498899",
            appId: "1:451995498899:web:038e98ff1742ff581d9066",
            measurementId: "G-8X7LQ4HH6K"
        };

        // Inicializando o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        const names = ["Mayane", "Fernanda", "Alexsandro", "Jalon", "Ary", "Bernardo", "Emanuelle", "Bruno"];
        
        function normalizeName(inputName) {
            return inputName.trim().toUpperCase();
        }

        async function startDraw() {
            const userName = normalizeName(document.getElementById("userName").value);
            const password = document.getElementById("password").value;
            if (!userName || !password) {
                alert("Por favor, insira seu nome e senha.");
                return;
            }

            // Salvar o nome e a senha no Firestore
            const userRef = db.collection('users').doc(userName);
            const userDoc = await userRef.get();

            if (userDoc.exists) {
                alert("Você já fez o sorteio.");
                return;
            }

            await userRef.set({
                password: password,
                name: userName
            });

            const filteredNames = names.filter(name => normalizeName(name) !== userName);
            if (filteredNames.length === 0) {
                document.getElementById("result").innerText = "Não há mais nomes para sortear.";
                return;
            }

            const randomIndex = Math.floor(Math.random() * filteredNames.length);
            const drawnName = filteredNames[randomIndex];

            // Salvar o resultado do sorteio no Firestore
            await userRef.update({
                drawnName: drawnName
            });

            document.getElementById("result").innerHTML = `<strong>Você tirou: ${drawnName}!</strong>`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const userNameInput = document.getElementById("userName");
            const passwordInput = document.getElementById("password");
            const nextButton = document.getElementById("nextButton");
            const startDrawButton = document.getElementById("startDraw");

            // Passo 1: Nome
            nextButton.addEventListener("click", () => {
                const userName = normalizeName(userNameInput.value);
                if (!userName) {
                    alert("Por favor, insira seu nome.");
                    return;
                }

                // Mostrar a criação da senha
                document.getElementById("nameInput").style.display = "none";
                document.getElementById("passwordInput").style.display = "block";
            });

            // Passo 2: Sorteio após senha
            startDrawButton.addEventListener("click", () => {
                startDraw();
                startDrawButton.disabled = true;
                passwordInput.disabled = true;
                nextButton.disabled = true;
            });
        });
    </script>
</body>
</html>
